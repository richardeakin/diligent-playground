#include "shaders/particles/structures.fxh"

cbuffer SConstants {
    SceneConstants SConstants;
};

cbuffer PConstants {
    ParticleConstants PConstants;
};

struct PSInput { 
    float4 Pos      : SV_POSITION; 
    float2 UV       : TEX_COORD;
    float  Temp     : TEMPERATURE;
    float3 Normal   : NORMAL;
    uint InstID     : INSTANCE_ID;
};

struct PSOutput {
    float4 Color : SV_TARGET;
};

void main( in  PSInput  PSIn, out PSOutput PSOut )
{
    float3 col = lerp( float3( 0.0, 0.63, 0.9 ), float3( 0.2, 0.78, 0.95 ), saturate( PSIn.Temp ) );
    //col = float3( 1, 1, 1 );

    float NdotL = saturate( dot( PSIn.Normal, - SConstants.LightDirection.xyz ) );

    float lighting = NdotL * 0.8 + 0.1;
    col *= lighting;
    
    float emmissive = pow(PSIn.UV.y, 2);
    emmissive *= sin( PConstants.time * 4.0 + float(PSIn.InstID) * 10231.12 ) * 0.5 + 0.5;
    
    col = lerp(col, float3(emmissive, 0.0, 0.0), emmissive);
    
    if( PSIn.InstID == 0 ) {
        col.r = 1.0;
    }
    if( PSIn.InstID == 1 ) {
        col.g = 1.0;
    }
    if( PSIn.InstID == 2 ) {
        col.b = 1.0;
    }

    //PSOut.Color = float4( PSIn.UV.x, PSIn.UV.y, 0.0, 1.0 );
    PSOut.Color = float4( col, emmissive * 4.0 );
    // PSOut.Color.r = 0;
    // PSOut.Color = float4( 1, 0, 0, 1 );
}
